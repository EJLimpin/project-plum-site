{"filter":false,"title":"User.php","tooltip":"/classes/User.php","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":103,"column":60},"end":{"row":103,"column":61},"action":"remove","lines":["u"],"id":2663}],[{"start":{"row":103,"column":60},"end":{"row":103,"column":61},"action":"insert","lines":["r"],"id":2664}],[{"start":{"row":103,"column":61},"end":{"row":103,"column":62},"action":"insert","lines":["i"],"id":2665}],[{"start":{"row":103,"column":62},"end":{"row":103,"column":63},"action":"insert","lines":["e"],"id":2666}],[{"start":{"row":103,"column":62},"end":{"row":103,"column":63},"action":"remove","lines":["e"],"id":2667}],[{"start":{"row":103,"column":61},"end":{"row":103,"column":62},"action":"remove","lines":["i"],"id":2668}],[{"start":{"row":103,"column":61},"end":{"row":103,"column":62},"action":"insert","lines":["u"],"id":2669}],[{"start":{"row":103,"column":62},"end":{"row":103,"column":63},"action":"insert","lines":["e"],"id":2670}],[{"start":{"row":104,"column":7},"end":{"row":104,"column":8},"action":"remove","lines":[" "],"id":2671},{"start":{"row":104,"column":7},"end":{"row":105,"column":0},"action":"insert","lines":["",""]},{"start":{"row":105,"column":0},"end":{"row":105,"column":7},"action":"insert","lines":["       "]}],[{"start":{"row":105,"column":7},"end":{"row":107,"column":8},"action":"insert","lines":["","            ","        "],"id":2672}],[{"start":{"row":105,"column":7},"end":{"row":105,"column":8},"action":"insert","lines":["p"],"id":2673}],[{"start":{"row":105,"column":8},"end":{"row":105,"column":9},"action":"insert","lines":["r"],"id":2674}],[{"start":{"row":105,"column":9},"end":{"row":105,"column":10},"action":"insert","lines":["i"],"id":2675}],[{"start":{"row":105,"column":10},"end":{"row":105,"column":11},"action":"insert","lines":["n"],"id":2676}],[{"start":{"row":105,"column":11},"end":{"row":105,"column":12},"action":"insert","lines":["t"],"id":2677}],[{"start":{"row":105,"column":12},"end":{"row":105,"column":13},"action":"insert","lines":["_"],"id":2678}],[{"start":{"row":105,"column":13},"end":{"row":105,"column":14},"action":"insert","lines":["r"],"id":2679}],[{"start":{"row":105,"column":14},"end":{"row":105,"column":16},"action":"insert","lines":["()"],"id":2680}],[{"start":{"row":105,"column":15},"end":{"row":105,"column":16},"action":"insert","lines":["$"],"id":2681}],[{"start":{"row":105,"column":16},"end":{"row":105,"column":17},"action":"insert","lines":["p"],"id":2682}],[{"start":{"row":105,"column":17},"end":{"row":105,"column":18},"action":"insert","lines":["e"],"id":2683}],[{"start":{"row":105,"column":18},"end":{"row":105,"column":19},"action":"insert","lines":["r"],"id":2684}],[{"start":{"row":105,"column":19},"end":{"row":105,"column":20},"action":"insert","lines":["m"],"id":2685}],[{"start":{"row":105,"column":20},"end":{"row":105,"column":21},"action":"insert","lines":["i"],"id":2686}],[{"start":{"row":105,"column":21},"end":{"row":105,"column":22},"action":"insert","lines":["s"],"id":2687}],[{"start":{"row":105,"column":22},"end":{"row":105,"column":23},"action":"insert","lines":["s"],"id":2688}],[{"start":{"row":105,"column":23},"end":{"row":105,"column":24},"action":"insert","lines":["i"],"id":2689}],[{"start":{"row":105,"column":24},"end":{"row":105,"column":25},"action":"insert","lines":["o"],"id":2690}],[{"start":{"row":105,"column":25},"end":{"row":105,"column":26},"action":"insert","lines":["n"],"id":2691}],[{"start":{"row":105,"column":26},"end":{"row":105,"column":27},"action":"insert","lines":["s"],"id":2692}],[{"start":{"row":105,"column":28},"end":{"row":105,"column":29},"action":"insert","lines":[";"],"id":2693}],[{"start":{"row":105,"column":2},"end":{"row":105,"column":29},"action":"remove","lines":["     print_r($permissions);"],"id":2694}],[{"start":{"row":105,"column":1},"end":{"row":105,"column":2},"action":"remove","lines":[" "],"id":2695}],[{"start":{"row":105,"column":0},"end":{"row":105,"column":1},"action":"remove","lines":[" "],"id":2696}],[{"start":{"row":104,"column":7},"end":{"row":105,"column":0},"action":"remove","lines":["",""],"id":2697}],[{"start":{"row":104,"column":7},"end":{"row":104,"column":8},"action":"insert","lines":["i"],"id":2698}],[{"start":{"row":104,"column":8},"end":{"row":104,"column":9},"action":"insert","lines":["f"],"id":2699}],[{"start":{"row":104,"column":9},"end":{"row":104,"column":11},"action":"insert","lines":["()"],"id":2700}],[{"start":{"row":104,"column":10},"end":{"row":104,"column":11},"action":"insert","lines":["$"],"id":2701}],[{"start":{"row":104,"column":11},"end":{"row":104,"column":12},"action":"insert","lines":["p"],"id":2702}],[{"start":{"row":104,"column":12},"end":{"row":104,"column":13},"action":"insert","lines":["e"],"id":2703}],[{"start":{"row":104,"column":13},"end":{"row":104,"column":14},"action":"insert","lines":["r"],"id":2704}],[{"start":{"row":104,"column":14},"end":{"row":104,"column":15},"action":"insert","lines":["m"],"id":2705}],[{"start":{"row":104,"column":15},"end":{"row":104,"column":16},"action":"insert","lines":["i"],"id":2706}],[{"start":{"row":104,"column":16},"end":{"row":104,"column":17},"action":"insert","lines":["s"],"id":2707}],[{"start":{"row":104,"column":17},"end":{"row":104,"column":18},"action":"insert","lines":["s"],"id":2708}],[{"start":{"row":104,"column":18},"end":{"row":104,"column":19},"action":"insert","lines":["i"],"id":2709}],[{"start":{"row":104,"column":19},"end":{"row":104,"column":20},"action":"insert","lines":["o"],"id":2710}],[{"start":{"row":104,"column":20},"end":{"row":104,"column":21},"action":"insert","lines":["n"],"id":2711}],[{"start":{"row":104,"column":21},"end":{"row":104,"column":22},"action":"insert","lines":["s"],"id":2712}],[{"start":{"row":104,"column":21},"end":{"row":104,"column":22},"action":"remove","lines":["s"],"id":2714}],[{"start":{"row":104,"column":21},"end":{"row":104,"column":23},"action":"insert","lines":["[]"],"id":2715}],[{"start":{"row":104,"column":22},"end":{"row":104,"column":23},"action":"insert","lines":["$"],"id":2716}],[{"start":{"row":104,"column":23},"end":{"row":104,"column":24},"action":"insert","lines":["k"],"id":2717}],[{"start":{"row":104,"column":24},"end":{"row":104,"column":25},"action":"insert","lines":["e"],"id":2718}],[{"start":{"row":104,"column":25},"end":{"row":104,"column":26},"action":"insert","lines":["y"],"id":2719}],[{"start":{"row":104,"column":28},"end":{"row":104,"column":29},"action":"insert","lines":["{"],"id":2720}],[{"start":{"row":104,"column":29},"end":{"row":106,"column":8},"action":"insert","lines":["","           ","       }"],"id":2721}],[{"start":{"row":104,"column":27},"end":{"row":104,"column":28},"action":"insert","lines":["="],"id":2722}],[{"start":{"row":104,"column":28},"end":{"row":104,"column":29},"action":"insert","lines":["="],"id":2723}],[{"start":{"row":104,"column":29},"end":{"row":104,"column":30},"action":"insert","lines":["="],"id":2724}],[{"start":{"row":104,"column":30},"end":{"row":104,"column":31},"action":"insert","lines":["t"],"id":2725}],[{"start":{"row":104,"column":31},"end":{"row":104,"column":32},"action":"insert","lines":["r"],"id":2726}],[{"start":{"row":104,"column":32},"end":{"row":104,"column":33},"action":"insert","lines":["u"],"id":2727}],[{"start":{"row":104,"column":33},"end":{"row":104,"column":34},"action":"insert","lines":["e"],"id":2728}],[{"start":{"row":104,"column":29},"end":{"row":104,"column":30},"action":"remove","lines":["="],"id":2729}],[{"start":{"row":105,"column":11},"end":{"row":105,"column":12},"action":"insert","lines":["r"],"id":2730}],[{"start":{"row":105,"column":12},"end":{"row":105,"column":13},"action":"insert","lines":["e"],"id":2731}],[{"start":{"row":105,"column":13},"end":{"row":105,"column":14},"action":"insert","lines":["t"],"id":2732}],[{"start":{"row":105,"column":14},"end":{"row":105,"column":15},"action":"insert","lines":["u"],"id":2733}],[{"start":{"row":105,"column":15},"end":{"row":105,"column":16},"action":"insert","lines":["r"],"id":2734}],[{"start":{"row":105,"column":16},"end":{"row":105,"column":17},"action":"insert","lines":["n"],"id":2735}],[{"start":{"row":105,"column":17},"end":{"row":105,"column":18},"action":"insert","lines":[" "],"id":2736}],[{"start":{"row":105,"column":18},"end":{"row":105,"column":19},"action":"insert","lines":["t"],"id":2737}],[{"start":{"row":105,"column":19},"end":{"row":105,"column":20},"action":"insert","lines":["r"],"id":2738}],[{"start":{"row":105,"column":20},"end":{"row":105,"column":21},"action":"insert","lines":["u"],"id":2739}],[{"start":{"row":105,"column":21},"end":{"row":105,"column":22},"action":"insert","lines":["e"],"id":2740}],[{"start":{"row":105,"column":22},"end":{"row":105,"column":23},"action":"insert","lines":[";"],"id":2741}],[{"start":{"row":108,"column":9},"end":{"row":109,"column":0},"action":"insert","lines":["",""],"id":2742},{"start":{"row":109,"column":0},"end":{"row":109,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":109,"column":8},"end":{"row":109,"column":9},"action":"insert","lines":["r"],"id":2743}],[{"start":{"row":109,"column":9},"end":{"row":109,"column":10},"action":"insert","lines":["e"],"id":2744}],[{"start":{"row":109,"column":10},"end":{"row":109,"column":11},"action":"insert","lines":["t"],"id":2745}],[{"start":{"row":109,"column":11},"end":{"row":109,"column":12},"action":"insert","lines":["u"],"id":2746}],[{"start":{"row":109,"column":12},"end":{"row":109,"column":13},"action":"insert","lines":["r"],"id":2747}],[{"start":{"row":109,"column":13},"end":{"row":109,"column":14},"action":"insert","lines":["n"],"id":2748}],[{"start":{"row":109,"column":14},"end":{"row":109,"column":15},"action":"insert","lines":[" "],"id":2749}],[{"start":{"row":109,"column":15},"end":{"row":109,"column":16},"action":"insert","lines":["f"],"id":2750}],[{"start":{"row":109,"column":16},"end":{"row":109,"column":17},"action":"insert","lines":["a"],"id":2751}],[{"start":{"row":109,"column":17},"end":{"row":109,"column":18},"action":"insert","lines":["l"],"id":2752}],[{"start":{"row":109,"column":18},"end":{"row":109,"column":19},"action":"insert","lines":["s"],"id":2753}],[{"start":{"row":109,"column":19},"end":{"row":109,"column":20},"action":"insert","lines":["e"],"id":2754}],[{"start":{"row":109,"column":20},"end":{"row":109,"column":21},"action":"insert","lines":[";"],"id":2755}],[{"start":{"row":104,"column":21},"end":{"row":104,"column":22},"action":"insert","lines":["s"],"id":2756}],[{"start":{"row":39,"column":7},"end":{"row":43,"column":4},"action":"remove","lines":[" if(!$this->_db->update('users',$id,$fields){","            throw new Exception('There was a problem updating');","        }","    }","    "],"id":2757},{"start":{"row":39,"column":7},"end":{"row":42,"column":3},"action":"insert","lines":["    if(!$this->_db->insert('users', $fields)) {","      throw new Exception('There was a problem creating an account.');","    }","  }"]}],[{"start":{"row":0,"column":0},"end":{"row":131,"column":1},"action":"remove","lines":["<?php","class User{","    private $_db,","    $_data,","    $_sessionName,","     $_cookieName,","    $_isLoggedIn;","    ","    public function __construct($user = null){","        $this->_db = DB::getInstance();","        ","        $this->_sessionName = Config::get('session/session_name');","         $this->_cookieName = Config::get('remember/cookie_name');","        ","       if(!$user){","           if(Session::exists($this->_sessionName)){","               $user = Session::get($this->_sessionName);","               ","               ","               if($this->find($user)){","                   $this->_isLoggedIn = true;","               }else{","                   //process Logout","               }","               ","           }","           ","        }else{","            $this->find($user);","        }","        ","    }","    ","    public function update($fields = array(),$id=null){","        ","        if(!id && $this->isLoggedIn()){","            $id=$this->data()->id;","        }","        ","           if(!$this->_db->insert('users', $fields)) {","      throw new Exception('There was a problem creating an account.');","    }","  }","    public function create($fields = array()){","        if(!$this->_db->insert('users',$fields)){","            throw new Exception('There was a problem creating an account.');","        }","    }","    ","    public function find($user = null){","        if($user){","            $field = (is_numeric($user))?'id' : 'username';","            $data = $this->_db->get('users',array($field,'=',$user));","      ","      if($data->count()){","          $this->_data=$data->first();","          return true;","      }","        }","        return false;","    }","    ","    public function login($username = null,$password = null,$remember = false){","   ","    ","    if(!$username && !$password && $this->exists()){","       Session::put($this->sessionName, $this->data()->id);","        ","    }else{","         $user = $this->find($username);","   if($user){","       if($this->data()->password === Hash::make($password,$this->data()->salt)){","           Session::put($this->_sessionName, $this->data()->id);","           ","           if ($remember) {","            $hash = Hash::unique();","            $hashCheck = $this->_db->get('users_session', array('user_id', '=', $this->data()->id));","            if (!$hashCheck->count()) {","              $this->_db->insert('users_session', array(","                'user_id' => $this->data()->id,","                'hash' => $hash","              ));","            } else {","              $hash = $hashCheck->first()->hash;","            }","               Cookie::put($this->_cookieName,$hash, Config::get('remember/cookie_expiry'));","               ","           }","           ","           return true;","       }","   }","    ","        ","    }","    return false;","    }","    ","    public function hasPermission($key){","        $group = $this->_db->get('groups',array('id','=',$this->data()->group));","","        if($group->count()){","    $permissions =json_decode ($group->first()->permission,true);","       if($permissions[$key]==true){","           return true;","       }","            ","        }","        return false;","    }","    ","    public function exists(){","        return (!empty($this->data)) ? true:false","    }","    ","    ","    public function logout(){","        ","        $this->_db->delete('users_session',array('user_id','=', $this->data()->id));","        ","        Session::delete($this->_sessionName);","        Cookie::delete($this->_cookieName);","    }","    ","    public function data(){","        return $this->_data;","    }","public function isLoggedIn(){","    return$this->_isLoggedIn;","}","","}"],"id":2758},{"start":{"row":0,"column":0},"end":{"row":114,"column":1},"action":"insert","lines":["<?php","class User {","  private $_db,","          $_data,","          $_sessionName,","          $_cookieName,","          $_isLoggedIn;","  public function __construct($user = null)","  {","    $this->_db = DB::getInstance();","    $this->_sessionName = Config::get('session/session_name');","    $this->_cookieName = Config::get('remember/cookie_name');","    if (!$user) {","      if (Session::exists($this->_sessionName)) {","        $user = Session::get($this->_sessionName);","        if ($this->find($user)) {","          $this->_isLoggedIn = true;","        } else {","          // process logout","        }","      }","    } else {","      $this->find($user);","    }","  }","  public function update($fields = array(), $id = null)","  {","    if (!$id && $this->isLoggedIn()) {","      $id = $this->data()->id;","    }","    if (!$this->_db->update('users', $id, $fields)) {","      throw new Exception('There was a problem updating.');","    }","  }","  public function create($fields)","  {","    if(!$this->_db->insert('users', $fields)) {","      throw new Exception('There was a problem creating an account.');","    }","  }","  public function find($user = null)","  {","    if($user) {","      $field = (is_numeric($user)) ? 'id' : 'username';","      $data = $this->_db->get('users', array($field, '=', $user));","      if($data->count()) {","        $this->_data = $data->first();","        return true;","      }","    }","    return false;","  }","  public function login($username = null, $password = null, $remember = false)","  {","    if (!$username && !$password && !$this->exists()) {","      // log user in","      Session::put($this->_sessionName, $this->data()->id);","    } else {","      $user = $this->find($username);","      //print_r($this->_data);]","      if($user) {","        if($this->data()->password === Hash::make($password, $this->data()->salt)) {","          //echo \"Ok!\";","          Session::put($this->_sessionName, $this->data()->id);","          if ($remember) {","            $hash = Hash::unique();","            $hashCheck = $this->_db->get('users_session', array('user_id', '=', $this->data()->id));","            if (!$hashCheck->count()) {","              $this->_db->insert('users_session', array(","                'user_id' => $this->data()->id,","                'hash' => $hash","              ));","            } else {","              $hash = $hashCheck->first()->hash;","            }","            Cookie::put($this->_cookieName, $hash, Config::get('remember/cookir_expiry'));","          }","          return true;","        }","      }","    }","    return false;","  }","  public function hasPermission($key)","  {","    $group = $this->_db->get('groups', array('id', '=', $this->data()->group));","    // print_r($group->first());","    if ($group->count()) {","      $permissions = json_decode($group->first()->permissions, true);","      //print_r($permissions);","      if ($permissions[$key] == true) {","        return true;","      }","    }","    return false;","  }","  public function exists()","  {","    return (!empty($this->_data)) ? true : false;","  }","  public function logout()","  {","    $this->_db->delete('users_session', array('user_id', '=', $this->data()=>id));","    Session::delete($this->_sessionName);","    Cookie::delete($this->_cookieName);","  }","  public function data()","  {","    return $this->_data;","  }","  public function isLoggedIn()","  {","    return $this->_isLoggedIn;","  }","}"]}],[{"start":{"row":62,"column":8},"end":{"row":62,"column":23},"action":"remove","lines":["  //echo \"Ok!\";"],"id":2759}],[{"start":{"row":59,"column":3},"end":{"row":59,"column":31},"action":"remove","lines":["   //print_r($this->_data);]"],"id":2760}],[{"start":{"row":55,"column":3},"end":{"row":55,"column":20},"action":"remove","lines":["   // log user in"],"id":2761}],[{"start":{"row":89,"column":3},"end":{"row":89,"column":30},"action":"remove","lines":["   //print_r($permissions);"],"id":2762}],[{"start":{"row":86,"column":2},"end":{"row":86,"column":32},"action":"remove","lines":["  // print_r($group->first());"],"id":2763}],[{"start":{"row":18,"column":0},"end":{"row":18,"column":27},"action":"remove","lines":["          // process logout"],"id":2764}]]},"ace":{"folds":[],"scrolltop":180,"scrollleft":0,"selection":{"start":{"row":22,"column":25},"end":{"row":28,"column":30},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1511349607634,"hash":"fd23f89d678af9a40324533d8ab7754ec0ba6e9b"}